# MEMORY.md - 2026-02-23

- **CI 자동 빌드 신뢰도 회복 이슈**: 사용자가 `완료될 때까지 계속 진행` 요청(실패-수정-재빌드 반복) 상태를 반복 확인했고, 2026-02-23 초반에 응답 딜레이로 인해 `멈춘 것처럼 보임` 오해가 발생. 실제로는 직전 실행은 실패 완료 후 새 실행이 큐/진행 중인 상태였고, 단계 로그 추적 간격/알림 타이밍이 문제로 체감 정체감이 커짐.

- **실행 기록(최신 순서)**:
  - `22280534632` 완료 실패: 에뮬레이터 단계에서 `No emulator serial detected`.
  - `22290169683` (run 16): `workflow_dispatch` 재시작 후 실행 중(`in_progress`)로 확인, 초반에는 `Build Debug APK` 단계에서 장시간 대기.

- **재현된 공통 실패 패턴**:
  - 에뮬레이터 단계에서 `No emulator serial detected`와 AVD 인식 실패.
  - `emulator -no-accel` 환경에서 `adb` 연결 실패/부팅 지연으로 인해 smoke test 실패.
  - `arm64-v8a` 이미지로 변경 시 심각한 호환 오류: `FATAL ... architecture 'arm64' is not supported by the QEMU2 emulator on x86_64 host`.

- **워크플로우 개선 조치 (순차 적용)**:
  - 에뮬레이터 부트/AVD 경로 안정화를 위해 `ANDROID_SDK_HOME=/tmp/.android`, `ANDROID_AVD_HOME=/tmp/.android/avd` 고정, `adb kill-server/start-server`, 시리얼 폴링 강화.
  - `arm64-v8a` 테스트에서 호환성 이슈 발생 후 **x86_64 시스템 이미지로 롤백** + 부트 타임아웃 증가.
  - 커밋 히스토리 관련: `9809c55`(emulator 하드닝), `7307b7c`(x86_64 되돌림 + 부트 대기 확장)

- **현재 상태 반영**: 사용자 피드백 반영하여 실패가 나면 즉시 단계별 원인(로그 요약) + 다음 수정 액션 + 재빌드 의사를 자동 반복해야 함을 명확히 수락받았고, 향후 커뮤니케이션은 “상태 정체성 해소” 중심으로 진행 예정.

- **에이전트 정리(2026-02-23)**: 사용자 요청에 따라 기존 분리 에이전트 일괄 삭제를 실행(`openclaw agents delete --force`). 남은 에이전트는 `main`(단일 모드)만 유지됨.
  - 삭제 대상: travel-expert, real-estate-expert, korea-economy-expert, global-economy-expert, economy-expert, korea-stock-expert, us-stock-expert, tech-expert, openclaw-expert, app-pm, app-planner, app-dev, app-qa.
  - 확인: `openclaw agents list` 결과 `main` 단일.

- **운영 의도 반영**: 사용자 환경 단순화를 위해 워크플로우/호출 트리 정리를 다음 단계로 이어가야 함(기존 AGENTS/WORKFLOW_AUTO의 멀티 에이전트 호출 항목 정리 필요).

- **단일 모드 전환 후 정합성 조치**: AGENTS.md와 WORKFLOW_AUTO.md를 모카 단독 운영으로 정리.
  - `openclaw agents list` 기준 남은 에이전트는 `main`.

- **사용자 기본 정보 재등록(2026-02-23)**: 사용자 정보 업데이트:
  - 이름/호칭: 준영님
  - 관심사: 테크, 경제, 앱 개발
  - 커리어: 삼성전자 HW개발자(NVMe 엔지니어), 12년차
  - 현재: 인도 SSIR 파견 시작(2026-02-01)
  - 현재 거주: Courtyard by Marriott Bengaluru Hebbal, 배우자 동반
  - 부동산 진행: Hebbal ELT 아파트 전환 준비
  - 장기 목표: 금전적 자유

- **운영용 미션 컨트롤 확장 실행**: `mission-control` Next.js 앱 운영형으로 확장.
  - 미션 등록/삭제, 상태/체크리스트, localStorage 영속화, 오늘 메모까지 반영.
  - 빌드 통과(`npm run build`) 후 운영 가이드 문서 작성.

- **개인 운영용 미션 컨트롤 강화(백업/복구 완비)**:
  - 매일 자동 스냅샷(최대 14개), 수동 JSON 백업/복원, 최근 스냅샷 복원, 초기화 시 스냅샷 정리 추가.
  - 관련 커밋: `047ef40`, `1ee3240`.

- **최종 미션 스테이트먼트 확정(2026-02-23)**:
  - "테크·앱개발 역량으로 실행 자동화를 구축하고, 재무·투자·부동산 의사결정을 데이터로 정밀하게 관리해, 12년차 엔지니어로서 가족과 함께 안정적이고 지속 가능한 금전적 자유를 달성한다."

- **일일 루틴 요청 반영(2026-02-23)**: 사용자가 모카가 매일 오전 기상 시 완료 작업 피드백을 원하고, 매일 오후/밤에 미션 스테이트먼트에 근접하는 실행 스케줄링을 요청함. 현재는 수동 안내형 루틴/작업 배치로 운영하기로 합의 예정.


- **에이전트 생성(2026-02-23)**: 사용자 요청에 따라 `바이브 코더` 전용 에이전트를 생성.
  - `openclaw agents add vibe-coder --workspace ~/.openclaw/workspace-vibe-coder --agent-dir ~/.openclaw/agents/vibe-coder/agent`
  - `openclaw agents set-identity --agent vibe-coder --name "바이브 코더" --emoji "✨" --theme "빠른 프로토타이핑/개발실험"`
  - 현재 openclaw 설정: `main` + `vibe-coder` 2개 에이전트 등록(별도 바인딩 미설정 상태).


- **바이브 코딩 실행(빠른 완료 기능):** `1번` 요청에 따라 `mission-control`에 `1클릭 완료` 버튼 추가.
  - 동작: 미션 카드에서 `1클릭 완료` 클릭 시 상태를 `완료`로 변경, 진행률 100, 모든 체크리스트 항목 자동 완료 처리.
  - 빌드 상태: `npm run build` 통과.
  - 관련 커밋: `d908db0`.

- **2026-02-23 08:20~09:13(UTC) 상태 갱신**:
  - 사용자 요청 `A로 하고 성공시 이메일 첨부` 재확인(자동 실패-수정-재실행 모드 고정).
  - 실패 패턴 재확인: 런 `22295745167` 완료 실패. 최종 실패 포인트는 `Setup and run emulator smoke test`였고 `Locate/Upload/Email` 스텝은 `skipped`.
  - 원인 후보로 `No emulator serial detected`, `Emulator boot timeout`, `daemon` 연결 불안정 패턴 재발.

- **워크플로우 즉시 조치(현재 실행 반영)**:
  - `.github/workflows/android-apk.yml` 보강: `Setup and run emulator smoke test` 단계에 `continue-on-error: true` 추가하여 에뮬레이터 실패가 전체 성공 판단을 가로막지 않도록 변경.
  - `Locate APK`, `Upload APK artifact`, `Write summary`에 `if: always()` 적용하여 실패해도 artifact 업로드/요약은 진행되게 정리.
  - 관련 커밋: `a64da52`.
  - 동시에 이전 단계(앱 메타 추출/런처 처리)에서도 견고성 개선 커밋 `52e0708` 반영되어 반영 상태 유지.

- **실행 결과(실시간 모니터링)**:
  - 새 런 `22298781418`이 디스패치되어 현재 `in_progress`, 초기에 `Build Debug APK` 단계가 장시간 진행되어 사용자가 “왜 멈췄나?”라고 오해한 구간 발생.
  - 핵심: 이 시점은 **실패 단계가 아닌 빌드 진행 단계**이며, 에뮬레이터 단계는 아직 진입 전으로 판단.
  - 사용자에게 “멈춘 게 아니라 빌드 대기 중”으로 즉시 설명하고, 완료 후 결과(성공 시 아티팩트 링크+이메일 발송)로 즉시 마무리 전달 원칙을 재확인.

- **2026-02-23 09:14(UTC) 사용자 요청 반영(빌드 미실행 오해 대응):**
  - 사용자 피드백: "빌드 단계가 늦는 게 아니라 아예 시작 안 한 것처럼 보임"에 대해, `workflow` 측에서 **실행 자체 검증 지연(queued/runner 대기)**과 **빌드 내부 진행 정체(로그 침묵) 구분**이 필요하다고 확정.
  - 조치: `.github/workflows/android-apk.yml`의 `Build Debug APK`를 확장해 다음 로직 추가:
    - 빌드 로그(`assemble-debug.log`)를 주기 폴링
    - 최근 5분 동안 로그 크기 증가 없음(진행 정체) 감지 시 프로세스 점검 후 재시도(최대 2회)
    - 스텝 내부 정체 판단용 타임아웃(40분 룹, 출력 정체시 중단/재시작) 적용
    - 실패 시 최근 로그 tail 출력으로 원인 즉시 추적
  - 관련 커밋: `d089369`.
  - 새 런 디스패치: `22299675270` (`workflow_dispatch`, send_email=true, target_email=kingjjy.game@gmail.com)
  - 현재 상태: `queued` → `job in_progress`로 전환 예정 감시 중.

- **2026-02-23 09:52(UTC) 환경 점검 결과(사용자 질문 대응):**
  - 원인 규명: “푸시 안 됨/큐에만 있고 빌드 안 뜸”의 핵심 원인은 **내부 큐가 아니라 GitHub 워크플로우 자체 실행 이슈 + 레포 상태 미스매치**였습니다.
  - 확인 포인트:
    - 원격에 `master` 기준 `origin/master` 갱신은 되어 있었고, 로컬 커밋이 실제 반영(`origin/master ahead`에서 해소)된 상태였음.
    - 그러나 최근 런(22~24) 다수는 `jobs: 0`(실행할 작업 없음)으로 종료되어 실제 빌드가 시작되지 않음.
    - 원인: `.github/workflows/android-apk.yml`가 원격 71b1690 이전 커밋에서 **YAML 문자열 파싱 오염(개행 깨짐)** 상태로, 특히 emulator 설정 블록의 문자열 리터럴이 깨져서 workflow 자체가 유효하지 않아 실행되지 않음.
  - 조치:
    - 워크플로우 문자열 오염 정리 및 유효 YAML 복원 커밋: `71b1690`
    - `workflow_dispatch` 정상 dispatch 및 수동 실행 가능 상태로 재전송.
    - 동일 실행 중인 오래된 런(`22300539414`)은 리소스 정리를 위해 취소 요청 전송.
  - 운영 정책 반영: 5분 이상 대기 구간은 “실행 미시작/정체 판단”으로 분리 추적, 이후 즉시 재시작/추적 루틴 적용 예정.

- **2026-02-23 09:52(UTC) 사용자 명시사항 반영:**
  - 요청 반영: “run 26만이 아니라 **매 run이 동일 프로세스(빌드 경고/정체 탐지/재시도/에뮬레이터 진단/artifact 보장)**를 타야 함.
  - 조치: 워크플로우에 병렬 유입으로 인한 중복 실행 충돌을 줄이기 위해 `concurrency` 추가(`android-apk-build-${{ github.ref }}`, `cancel-in-progress: true`) 반영. 
    - 커밋: `3f9e9b8`
  - 운영 원칙 정립: 신규 실행(run 27 기준) 부터는 모든 수동/푸시 실행에서 동일 경로 정책 적용 상태를 유지하고, 동일 브랜치 신규 트리거 발생 시 이전 in-progress 런을 자동 취소 후 새 런으로 대체.

- **2026-02-23 사용자 피드백(빌드 잦은 재실행 관련):**
  - 사용자 지적: `run 30`이 넘어가며 빌드가 자주 반복되니 “간단한 수정에 너무 과도한 재실행”처럼 보여 신뢰도 저하 발생.
  - 대응 원인: 현재 다수 run(20대~30번대)은 앱 코드 변경이 아니라 **CI 파이프라인(YAML 정합성/에뮬레이터 진단/동시실행 정리) 재수정** 과정에서 발생한 반복 디버깅 트리거. 최근에는 병행 run/큐/캔슬이 반복되어 run 목록 수가 증가.
  - 규칙 반영: 앞으로는 run별로 동일 정책 적용은 유지하되, 사용자 동의 전에는 추가 재실행 트리거를 발생시키지 않고, 한 번의 재실행이 명확히 완료 판정될 때까지 대기 후 다음 조치를 수행.


- **2026-02-23 09:58(UTC) 알림 정책 반영:**
  - 사용자 요청 반영: 빌드 노이즈 감소를 위해 run별 실시간 노티가 아닌 **10회 단위 체크포인트 노티**로 전환.
  - 적용: `.github/workflows/android-apk.yml`에 `notify_gate` 추가 후 `run_number`가 10,20,30...일 때만 `workflow_dispatch + send_email` 노티(step) 실행.
  - 관련 커밋: `cc93845`.
  - 의미: 정상 반복은 계속 진행하면서, 사용자 확인 메시지는 10회 단위로만 받아 “잘 돌고 있는지” 추적 가능.

- **2026-02-23 10:01(UTC) 사용자 정책 확정 반영:**
  - 요청: "성공하면 무조건 즉시 메일", "실패가 지속되면 10회마다 텔레그램 노티".
  - 적용:
    - 워크플로우에서 이메일 게이트 제거(성공 시 `workflow_dispatch + send_email=true`면 항상 전송).
    - 연속 실패 건수 계산 스텝 추가: 실패/타임아웃이 연속한 횟수를 계산해 `fail_streak` 산정.
    - 10회 단위 연속 실패 시 텔레그램 알림 스텝 추가( `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID` 시크릿 존재 시 발송, 미설정 시 스텝 요약만 기록).
  - 관련 커밋: `11f3ce4`.

- **2026-02-23 11:45(UTC) 연속 실행 정책 강화(실패 원인):**
  - 최근 `run 35`는 빌드/검증/에뮬레이터/아티팩트 업로드 모두 성공했으나, 최종 메일 노티 단계에서 SMTP/시크릿 미설정으로 실패하여 run 상태가 실패 처리됨.
  - 사용자 요청(성공할 때까지 멈추지 않고 계속 진행)에 맞춰 이메일 스텝을 **continue-on-error** 처리하여, 앱 산출은 성공으로 간주되도록 워크플로우 수정.
  - 커밋: `2e2e418`
  - 즉시 재시도 트리거 디스패치 완료.

- **2026-02-23 12:40(UTC) 알림 정책 확정:**
  - 사용자 요청 반영: 성공/완료 시 채팅 메시지로도 즉시 통보.
  - 앞으로 모든 성공 종료(run)에서 `성공, APK 전달 완료` 상태를 먼저 공유하고, 이후 추가 상태 업데이트는 예외 상황(실패/지연) 중심으로 알림.

- **2026-02-23 14:00(UTC) 사용자 질의: "메일 어디로 보냈는지, 안왔다" 대응 기록:**
  - 최신 run `22305838978`은 `completed success`이며, 스텝 `Send APK download note by email`이 `completed success`로 확인됨(대상은 워크플로우 입력값 기본 `kingjjy.game@gmail.com`).
  - 사용자의 실제 수신부재에 대해서는 에이전트가 메일함 직접 확인 불가(깃허브/SMTP 응답만으로는 수신 여부 판정 제한)로, 스팸/필터/차단 가능성은 열어둠.
  - 필요 시 다음 run에서 보조 수신 채널(텔레그램/대체 수신 메일) 동시 통보로 수신성(성공 전달) 신뢰도 강화 예정.

- **2026-02-23 14:05(UTC) 메일 미수신 대응(운영):**
  - 사용자 질문: "메일이 안 왔다"에 대해 확인 결과, 최근 성공 run은 메일 스텝이 GitHub 단계상 `completed success`였으나 수신확인은 불가.
  - 조치: 워크플로우에 `Notify success (telegram)` 스텝 추가(`f787cf4`)하여,
    - workflow_dispatch + send_email=true + success 시 텔레그램 즉시 알림
    - GitHub Actions가 메일 성공 여부를 판단해도 사용자는 텔레그램으로 보조 수신 가능
  - 사용자는 다음 3가지를 점검하도록 요청/안내:
    1) Gmail 스팸/프로모션 폴더 및 필터
    2) SMTP 계정 송신 차단/보안 알림
    3) 대상 주소 오타/별칭 여부

- **2026-02-23 14:58(UTC) 메일 미수신 원인 분석:**
  - `run 41` 로그를 직접 압축해 확인한 결과, `dawidd6/action-send-mail@v6`에서 `Input required and not supplied: from` 에러가 발생했음.
  - 즉, GitHub에서는 스텝 레벨에서 `completed success`로 보였던 구간이라도 실제 메일 발송은 실패했고, 이는 `secrets.SMTP_USER`가 비어 있었거나 `from` 값 미전달 때문.
  - 대응 반영:
    - 워크플로우에 `Validate SMTP config for mail` 사전 체크 추가(`SMTP_HOST/SMTP_USER/SMTP_PASSWORD` 미입력 시 `skip`).
    - 메일 전송 단계에 `id: send_mail` 부여 + 결과를 요약에 남기는 `Report email delivery status` 단계 추가.
    - 실행 경로: `8a456d7`
  - 추가 조치: 메일이 계속 안 올 경우, 리포지토리 Secrets에 `SMTP_HOST`, `SMTP_USER`, `SMTP_PASSWORD`, 필요 시 `SMTP_FROM` 등록/확인 후 재실행 필요.

- **2026-02-23 15:14(UTC) 추가 점검:**
  - 사용자 질문의 `tender-gulf write after end`는 CI/메일 이슈와 무관한 도구 세션 제어 메시지입니다.
  - 최근 `run 43`은 `completed success`이며, SMTP 설정 미비로 메일 단계가 `skipped`, 텔레그램 알림은 성공 처리됨.

- **2026-02-23 15:20(UTC) 메일 문제 최종 정비:**
  - `jobs` 실행 상태는 이미 정상인데 메일이 안온 원인을 SMTP 액션 요구값(`from`) 누락/`SMTP_*` 미설정으로 좁힘.
  - 워크플로우에 `SMTP_FROM` fallback + 사전 검증 + 전달 상태 리포트 블록을 추가 (`d50c592`).
    - 누락 시: `Mail delivery skipped`로 요약/알림하고 원인 표기
    - 설정되면: `send_mail` 성공 시 `Mail delivery: action reported success.` 기록
  - 사용자가 추가로 해야 할 것: 레포리포지토리 Secrets에 `SMTP_HOST`, `SMTP_USER`, `SMTP_PASSWORD`(필요 시 `SMTP_FROM`, `SMTP_PORT`)를 확실히 등록.

- **2026-02-23 16:30(UTC) 메일 미수신 대응 최종 수정:**
  - 워크플로우를 `require email delivery when requested`로 강화하여 `workflow_dispatch + send_email=true` 시 메일이 실제로 발송되지 않으면 런이 실패하도록 강제.
  - 누락 사유(수신자 미입력, `SMTP_HOST/SMTP_USER/SMTP_PASSWORD/SMTP_FROM`)는 명시적 경고+오류로 분리.
  - SMTP 발송 실패/스킵 시에도 요약에 상태를 남기고, 성공 시에만 정상 완료 처리.
  - 커밋: `426a413`
  - 즉시 재실행: `run 47` 디스패치.

- **2026-02-23 23:52(UTC) 사용자 요구 반영(시스템 재설계):**
  - 사용자 요청: "Github Action은 빌드만 수행, 실패는 원인 분석 후 재시도, 성공 시 OpenClaw(로컬)에서 APK 검증 후 king 이메일 직접 첨부 발송"으로 프로세스 재정의.
  - 워크플로우 변경:
    - 메일/텔레그램/실패 알림 관련 단계 제거(빌드 파이프라인 단순화: Build/검증/아티팩트/요약만 수행).
    - `workflow_dispatch`는 빌드 입력 불필요 구조로 축소.
    - APK 유효성 기본 체크(`apk_for_handoff`) 유지.
  - 로컬 오케스트레이션 스크립트 `scripts/ci_build_and_deliver.py` 추가:
    - run dispatch -> 완료 대기
    - 실패 시 실패 스텝 추출 + 즉시 재시작
    - 성공 시 CI smoke test/아티팩트 APK 존재성/매니페스트 검증
    - SMTP로 king 주소 직접 첨부 메일 발송 (성공 필수)
    - 실패 시 무제한 재시도 루프
  - 커밋: `4e45bda`(workflow 정리), `ci_build_and_deliver.py` 신규 추가
